from fer import FER
import cv2
import numpy as np
from database import save_emotion

detector = FER()

def analyze_emotion(frame: np.ndarray) -> str:
    """Analyze frame and return dominant emotion."""
    emotion, _ = detector.top_emotion(frame)
    return emotion or "neutral"

def process_frame(frame_data: str):
    """Decode base64 image and analyze."""
    nparr = np.frombuffer(base64.b64decode(frame_data), np.uint8)
    frame = cv2.imdecode(nparr, cv2.IMREAD_COLOR)
    emotion = analyze_emotion(frame)
    save_emotion(emotion)
    return emotion